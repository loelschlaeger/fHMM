<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content='Fitting (hierarchical) hidden Markov models to financial data via maximum likelihood estimation. See Oelschläger, L. and Adam, T. "Detecting bearish and bullish markets in financial time series using hierarchical hidden Markov models" (2021, Statistical Modelling) &lt;doi:10.1177/1471082X211034048&gt; for a reference.'>
<title>Fit hidden Markov models to financial data • fHMM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Fit hidden Markov models to financial data">
<meta property="og:description" content='Fitting (hierarchical) hidden Markov models to financial data via maximum likelihood estimation. See Oelschläger, L. and Adam, T. "Detecting bearish and bullish markets in financial time series using hierarchical hidden Markov models" (2021, Statistical Modelling) &lt;doi:10.1177/1471082X211034048&gt; for a reference.'>
<meta property="og:image" content="https://loelschlaeger.de/fHMM/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">fHMM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="articles/fHMM.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/v01_model_definition.html">Model definition</a>
    <a class="dropdown-item" href="articles/v02_controls.html">Controls</a>
    <a class="dropdown-item" href="articles/v03_data_management.html">Data management</a>
    <a class="dropdown-item" href="articles/v04_model_estimation.html">Model estimation</a>
    <a class="dropdown-item" href="articles/v05_state_decoding_and_prediction.html">State decoding and prediction</a>
    <a class="dropdown-item" href="articles/v06_model_checking.html">Model checking</a>
    <a class="dropdown-item" href="articles/v07_model_selection.html">Model selection</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/loelschlaeger/fHMM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="hmms-for-finance-">HMMs for Finance 
<a class="anchor" aria-label="anchor" href="#hmms-for-finance-"></a>
</h1>
</div>
<!-- badges: start -->

<p>The <a href="https://loelschlaeger.de/fHMM/">fHMM</a> R package allows for the detection and characterization of financial market regimes in time series data by applying hidden Markov Models (HMMs). The <a href="https://loelschlaeger.de/fHMM/articles/">vignettes</a> outline the package functionality and the model formulation. For a reference on the method, see</p>
<blockquote>
<p>Oelschläger, L., and T. Adam. 2021. “Detecting Bearish and Bullish Markets in Financial Time Series Using Hierarchical Hidden Markov Models.” Statistical Modelling. <a href="https://doi.org/10.1177/1471082X211034048" class="external-link uri">https://doi.org/10.1177/1471082X211034048</a></p>
</blockquote>
<p>Below, we illustrate an application to the German stock index <a href="https://en.wikipedia.org/wiki/DAX" class="external-link">DAX</a>. We also show how to use the package to simulate HMM data, compute the model likelihood, and decode the hidden states using the Viterbi algorithm.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released package version from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"fHMM"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>We are open to contributions and would appreciate your input:</p>
<ul>
<li><p>If you encounter any issues, please <a href="https://github.com/loelschlaeger/fHMM/issues/new?assignees=&amp;labels=bug&amp;template=bug.md" class="external-link">submit bug reports as issues</a>.</p></li>
<li><p>If you have any ideas for new features, please submit them as <a href="https://github.com/loelschlaeger/fHMM/issues/new?assignees=&amp;labels=future&amp;template=suggestion.md" class="external-link">feature requests</a>.</p></li>
<li><p>If you would like to add extensions to the package, please fork the <code>master</code> branch and submit a merge request.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="example-fitting-an-hmm-to-the-dax">Example: Fitting an HMM to the DAX<a class="anchor" aria-label="anchor" href="#example-fitting-an-hmm-to-the-dax"></a>
</h2>
<p>We fit a 3-state HMM with state-dependent t-distributions to the DAX log-returns from 2000 to 2022. The states can be interpreted as proxies for bearish (green below) and bullish markets (red) and an “in-between” market state (yellow).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://loelschlaeger.de/fHMM/">"fHMM"</a></span><span class="op">)</span></span></code></pre></div>
<p>The package has a build-in function to download financial data from <a href="https://finance.yahoo.com/" class="external-link">Yahoo Finance</a>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dax</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/download_data.html">download_data</a></span><span class="op">(</span>symbol <span class="op">=</span> <span class="st">"^GDAXI"</span><span class="op">)</span></span></code></pre></div>
<p>We first need to define the model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controls</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/set_controls.html">set_controls</a></span><span class="op">(</span></span>
<span>  states      <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  sdds        <span class="op">=</span> <span class="st">"t"</span>,</span>
<span>  file        <span class="op">=</span> <span class="va">dax</span>,</span>
<span>  date_column <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>  data_column <span class="op">=</span> <span class="st">"Close"</span>,</span>
<span>  logreturns  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  from        <span class="op">=</span> <span class="st">"2000-01-01"</span>,</span>
<span>  to          <span class="op">=</span> <span class="st">"2022-12-31"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="reference/prepare_data.html">prepare_data()</a></code> then prepares the data for estimation:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/prepare_data.html">prepare_data</a></span><span class="op">(</span><span class="va">controls</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method gives an overview:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary of fHMM empirical data</span></span>
<span><span class="co">#&gt; * number of observations: 5882 </span></span>
<span><span class="co">#&gt; * data source: data.frame </span></span>
<span><span class="co">#&gt; * date column: Date </span></span>
<span><span class="co">#&gt; * log returns: TRUE</span></span></code></pre></div>
<p>We fit the model and subsequently decode the hidden states and compute (pseudo-) residuals:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/decode_states.html">decode_states</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_residuals.html">compute_residuals</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method gives an overview of the model fit:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary of fHMM model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   simulated hierarchy       LL       AIC       BIC</span></span>
<span><span class="co">#&gt; 1     FALSE     FALSE 17650.02 -35270.05 -35169.85</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; State-dependent distributions:</span></span>
<span><span class="co">#&gt; t() </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;                   lb   estimate        ub</span></span>
<span><span class="co">#&gt; Gamma_2.1  2.747e-03  5.024e-03 9.133e-03</span></span>
<span><span class="co">#&gt; Gamma_3.1  2.080e-13  2.060e-13 2.029e-13</span></span>
<span><span class="co">#&gt; Gamma_1.2  1.006e-02  1.839e-02 3.337e-02</span></span>
<span><span class="co">#&gt; Gamma_3.2  1.516e-02  2.446e-02 3.924e-02</span></span>
<span><span class="co">#&gt; Gamma_1.3  2.250e-11  2.232e-11 2.198e-11</span></span>
<span><span class="co">#&gt; Gamma_2.3  1.195e-02  1.898e-02 2.995e-02</span></span>
<span><span class="co">#&gt; mu_1      -3.862e-03 -1.793e-03 2.754e-04</span></span>
<span><span class="co">#&gt; mu_2      -7.994e-04 -2.649e-04 2.696e-04</span></span>
<span><span class="co">#&gt; mu_3       9.642e-04  1.272e-03 1.579e-03</span></span>
<span><span class="co">#&gt; sigma_1    2.354e-02  2.586e-02 2.840e-02</span></span>
<span><span class="co">#&gt; sigma_2    1.226e-02  1.300e-02 1.380e-02</span></span>
<span><span class="co">#&gt; sigma_3    5.390e-03  5.833e-03 6.312e-03</span></span>
<span><span class="co">#&gt; df_1       5.551e+00  1.084e+01 2.115e+01</span></span>
<span><span class="co">#&gt; df_2       6.814e+00  4.866e+01 3.475e+02</span></span>
<span><span class="co">#&gt; df_3       3.973e+00  5.248e+00 6.934e+00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; States:</span></span>
<span><span class="co">#&gt; decoded</span></span>
<span><span class="co">#&gt;    1    2    3 </span></span>
<span><span class="co">#&gt;  704 2926 2252 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; -3.517897 -0.664017  0.012171 -0.003261  0.673180  3.693577</span></span></code></pre></div>
<p>Having estimated the model, we can visualize the state-dependent distributions and the decoded time series:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fHMM_events.html">fHMM_events</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2001-09-11"</span>, <span class="st">"2008-09-15"</span>, <span class="st">"2020-01-27"</span><span class="op">)</span>,</span>
<span>       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"9/11 terrorist attack"</span>, <span class="st">"Bankruptcy Lehman Brothers"</span>, <span class="st">"First COVID-19 case Germany"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model</span>, plot_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sdds"</span>,<span class="st">"ts"</span><span class="op">)</span>, events <span class="op">=</span> <span class="va">events</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_model_fit-1.png"><!-- --><img src="reference/figures/README-plot_model_fit-2.png"><!-- --></p>
<p>The (pseudo-) residuals help to evaluate the model fit:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model</span>, plot_type <span class="op">=</span> <span class="st">"pr"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_model_residuals-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="simulating-hmm-data">Simulating HMM data<a class="anchor" aria-label="anchor" href="#simulating-hmm-data"></a>
</h2>
<p>The <a href="https://loelschlaeger.de/fHMM/">fHMM</a> package supports data simulation from an HMM and access to the model likelihood function for model fitting and the Viterbi algorithm for state decoding.</p>
<ol style="list-style-type: decimal">
<li>As an example, we consider a 2-state HMM with state-dependent Gamma distributions and a time horizon of 1000 data points.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controls</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/set_controls.html">set_controls</a></span><span class="op">(</span></span>
<span>  states  <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  sdds    <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>  horizon <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Define the model parameters via the <code><a href="reference/fHMM_parameters.html">fHMM_parameters()</a></code> function (unspecified parameters would be set at random).</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fHMM_parameters.html">fHMM_parameters</a></span><span class="op">(</span></span>
<span>  controls <span class="op">=</span> <span class="va">controls</span>,</span>
<span>  Gamma    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>  mu       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>  sigma    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Simulate data points from this model via the <code><a href="reference/simulate_hmm.html">simulate_hmm()</a></code> function.</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simulate_hmm.html">simulate_hmm</a></span><span class="op">(</span></span>
<span>  controls        <span class="op">=</span> <span class="va">controls</span>,</span>
<span>  true_parameters <span class="op">=</span> <span class="va">par</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">data</span>, col <span class="op">=</span> <span class="va">sim</span><span class="op">$</span><span class="va">markov_chain</span>, type <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-simulate-hmm-data-1.png"><!-- --></p>
<ol start="4" style="list-style-type: decimal">
<li>The log-likelihood function <code><a href="reference/ll_hmm.html">ll_hmm()</a></code> is evaluated at the identified and unconstrained parameter values, they can be derived via the <code><a href="reference/parameter_transformations.html">par2parUncon()</a></code> function.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">parUncon</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parameter_transformations.html">par2parUncon</a></span><span class="op">(</span><span class="va">par</span>, <span class="va">controls</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; gammasUncon_21 gammasUncon_12      muUncon_1      muUncon_2   sigmaUncon_1 </span></span>
<span><span class="co">#&gt;      -2.944439      -2.944439       0.000000       1.098612       0.000000 </span></span>
<span><span class="co">#&gt;   sigmaUncon_2 </span></span>
<span><span class="co">#&gt;       1.098612 </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "parUncon" "numeric"</span></span></code></pre></div>
<p>Note that this transformation takes care of the restrictions, that <code>Gamma</code> must be a transition probability matrix (which we can ensure via the logit link) and that <code>mu</code> and <code>sigma</code> must be positive (an assumption for the Gamma distribution, which we can ensure via the exponential link).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ll_hmm.html">ll_hmm</a></span><span class="op">(</span><span class="va">parUncon</span>, <span class="va">sim</span><span class="op">$</span><span class="va">data</span>, <span class="va">controls</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1620.515</span></span>
<span><span class="fu"><a href="reference/ll_hmm.html">ll_hmm</a></span><span class="op">(</span><span class="va">parUncon</span>, <span class="va">sim</span><span class="op">$</span><span class="va">data</span>, <span class="va">controls</span>, negative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1620.515</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>For maximum likelihood estimation of the model parameters, we can numerically optimize <code><a href="reference/ll_hmm.html">ll_hmm()</a></code> over <code>parUncon</code> (or rather minimize the negative log-likelihood).</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optimization</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nlm.html" class="external-link">nlm</a></span><span class="op">(</span></span>
<span>  f <span class="op">=</span> <span class="va">ll_hmm</span>, p <span class="op">=</span> <span class="va">parUncon</span>, observations <span class="op">=</span> <span class="va">sim</span><span class="op">$</span><span class="va">data</span>, controls <span class="op">=</span> <span class="va">controls</span>, negative <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;-</span> <span class="va">optimization</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -3.4633918 -3.4406564  0.0599985  1.0645290  0.1151781  1.0794625</span></span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>To interpret the estimate, it needs to be back transformed to the constrained parameter space via the <code><a href="reference/parameter_transformations.html">parUncon2par()</a></code> function. The state-labeling is not identified.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"parUncon"</span></span>
<span><span class="va">estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parameter_transformations.html">parUncon2par</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="va">controls</span><span class="op">)</span></span>
<span></span>
<span><span class="va">par</span><span class="op">$</span><span class="va">Gamma</span></span>
<span><span class="co">#&gt;         state_1 state_2</span></span>
<span><span class="co">#&gt; state_1    0.95    0.05</span></span>
<span><span class="co">#&gt; state_2    0.05    0.95</span></span>
<span><span class="va">estimate</span><span class="op">$</span><span class="va">Gamma</span></span>
<span><span class="co">#&gt;            state_1    state_2</span></span>
<span><span class="co">#&gt; state_1 0.96895127 0.03104873</span></span>
<span><span class="co">#&gt; state_2 0.03037199 0.96962801</span></span>
<span></span>
<span><span class="va">par</span><span class="op">$</span><span class="va">mu</span></span>
<span><span class="co">#&gt; muCon_1 muCon_2 </span></span>
<span><span class="co">#&gt;       1       3</span></span>
<span><span class="va">estimate</span><span class="op">$</span><span class="va">mu</span></span>
<span><span class="co">#&gt;  muCon_1  muCon_2 </span></span>
<span><span class="co">#&gt; 1.061835 2.899473</span></span>
<span></span>
<span><span class="va">par</span><span class="op">$</span><span class="va">sigma</span></span>
<span><span class="co">#&gt; sigmaCon_1 sigmaCon_2 </span></span>
<span><span class="co">#&gt;          1          3</span></span>
<span><span class="va">estimate</span><span class="op">$</span><span class="va">sigma</span></span>
<span><span class="co">#&gt; sigmaCon_1 sigmaCon_2 </span></span>
<span><span class="co">#&gt;   1.122073   2.943097</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=fHMM" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/loelschlaeger/fHMM/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/loelschlaeger/fHMM/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing fHMM</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://loelschlaeger.de" class="external-link">Lennart Oelschläger</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-5421-9313" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.uni-bielefeld.de/fakultaeten/wirtschaftswissenschaften/lehrbereiche/statisticalmodelling/" class="external-link">Timo Adam</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-9079-3259" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://ekvv.uni-bielefeld.de/pers_publ/publ/PersonDetail.jsp?personId=241029889" class="external-link">Rouven Michels</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-5433-6197" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=fHMM" class="external-link"><img src="https://www.r-pkg.org/badges/version/fHMM" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=fHMM" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/last-month/fHMM" alt="metacran downloads"></a></li>
<li><a href="https://github.com/loelschlaeger/fHMM/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/loelschlaeger/fHMM/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/loelschlaeger/fHMM" class="external-link"><img src="https://codecov.io/gh/loelschlaeger/fHMM/branch/master/graph/badge.svg?token=OYU22T74DV" alt="codecov"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://loelschlaeger.de" class="external-link">Lennart Oelschläger</a>, <a href="https://www.uni-bielefeld.de/fakultaeten/wirtschaftswissenschaften/lehrbereiche/statisticalmodelling/" class="external-link">Timo Adam</a>, <a href="https://ekvv.uni-bielefeld.de/pers_publ/publ/PersonDetail.jsp?personId=241029889" class="external-link">Rouven Michels</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
